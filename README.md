# 七圣召唤简易版 - 游戏服务器后端

## 1. 项目介绍
### 1.1 项目背景
基于《原神》七圣召唤玩法，开发的轻量级游戏服务器后端，聚焦“卡牌对战核心逻辑”“玩家状态管理”“安全验证”等核心模块，适配1v1实时对战场景。

### 1.2 核心目标
- 实现七圣召唤核心玩法：功能卡牌发放，骰子选择,元素反应、技能释放、回合制对战逻辑；
- 保障服务器安全性：防SQL注入、密码加密存储、玩家状态一致性；
- 具备基础扩展性：模块化设计，支持后续新增卡牌、角色、玩法规则。


## 2. 技术栈
- 核心框架：Spring Boot 3.4.x（快速搭建服务、依赖管理）；
- 数据访问：MyBatis + MySQL 8.0（玩家数据、对战记录存储）；
- 网络通信：Netty 4.x（TCP长连接，支持1v1对战实时消息传输）；
- 安全防护：BCrypt密码加密（密码非明文存储）、参数化查询（防SQL注入）；
- 设计模式：策略模式（元素反应逻辑）、工厂模式（技能实例创建）、单例模式（房间管理器）。

## 3. 功能模块设计
### 3.1 核心模块拆解
### 3.1 核心模块拆解
| 模块名称          | 职责说明                                                                 | 技术亮点                                                                 |
|-------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------|
| 网络通信模块（Network） | 管理TCP长连接生命周期，完成自定义游戏协议（登录、技能释放等指令）的编解码 | 基于Netty实现`GameProtocolDecoder/Encoder`，自定义协议编解码；支持多客户端并发连接，保障实时对战消息低延迟传输 |
| 核心玩法模块（GameSet） | 封装七圣召唤核心规则，包括战斗流程、卡牌体系、元素骰子、效果与技能逻辑   | - 元素反应：策略模式（`ElementReactionRule`+`impl`）支持“雷水感电”等反应灵活扩展；<br>- 卡牌体系：抽象`Card`基类，衍生`ActionCard`/`CharacterCard`等子类实现多态；<br>- 技能系统：工厂模式（`SkillFactory`）+策略模式（`SkillStrategy`），支持角色技能差异化创建与执行 |
| 请求处理模块（Handler） | 处理客户端各类指令请求（登录、自动匹配、战斗操作、卡牌选择等）| 基于`BaseHandler`实现责任链/模板模式，统一请求分发；部分Handler集成`AESGCM`加解密，保障敏感消息传输安全 |
| 房间管理模块（Room）| 负责房间创建、玩家匹配入房、对战状态同步及生命周期管理                   | `RoomManager`采用单例+`ConcurrentHashMap`管理全局房间；通过`ReentrantLock`保证多线程下房间状态（回合、对战进度）的线程安全 |
| 玩家会话模块（Player） | 维护玩家与服务器的连接会话，管理玩家游戏内状态（手牌、血量等）| `PlayerSessionManager`统一管理在线玩家会话，关联玩家与房间映射，支持断线重连场景下的状态恢复（可选扩展） |
| 服务器启动模块（Server） | 完成游戏服务器的初始化、Netty服务启动与核心组件配置                     | `GatewayInitializer`初始化Netty的`ChannelPipeline`（编解码器、Handler链）；`GatewayServer`封装服务启动逻辑，实现一键启动 |
### 3.1 核心模块拆解
| 模块名称          | 职责说明                                                                 | 技术亮点                                                                 |
|-------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------------|
| 网络通信模块（Network） | 管理 TCP 长连接生命周期，完成自定义游戏协议（如登录、技能释放等指令）的编解码 | 基于 Netty 实现 `GameProtocolDecoder`/`GameProtocolEncoder`，自定义协议编解码；<br>支持多客户端并发连接，保障实时对战消息低延迟传输 |
| 核心玩法模块（GameSet） | 封装七圣召唤核心规则，涵盖战斗流程、卡牌体系、元素骰子、效果与技能逻辑   | - 元素反应：通过 **策略模式**（`ElementReactionRule` + `impl` 实现类），支持“雷水感电”等反应的灵活扩展；<br>- 卡牌体系：抽象 `Card` 基类，衍生 `ActionCard`/`CharacterCard` 等子类，利用**多态**实现不同卡牌的差异化行为；<br>- 技能系统：结合 **工厂模式**（`SkillFactory`）与**策略模式**（`SkillStrategy`），支持角色技能的差异化创建与执行 |
| 请求处理模块（Handler） | 处理客户端各类指令请求（登录、自动匹配、战斗操作、卡牌选择等场景）| 基于 `GamePlayHandler` 实现**责任链/模板模式**，统一请求分发逻辑；<br>部分 Handler 集成 `AESGCM` 加解密算法，保障敏感消息传输安全 |
| 房间管理模块（Room）| 负责房间创建、玩家匹配入房、对战状态同步及房间生命周期管理               | `RoomManager` 采用**单例模式** + `ConcurrentHashMap` 管理全局房间；<br>通过 `ReentrantLock` 保证多线程场景下房间状态（回合流程、对战进度等）的线程安全 |
| 玩家会话模块（Player） | 维护玩家与服务器的连接会话，管理玩家游戏内状态（手牌、血量、元素附着等）| `PlayerSessionManager` 统一管理在线玩家会话，关联玩家与房间的映射关系；<br>支持断线重连场景下的玩家状态恢复（可选扩展方向） |
| 服务器启动模块（Server） | 完成游戏服务器的初始化、Netty 服务启动与核心组件配置                     | `GatewayInitializer` 初始化 Netty 的 `ChannelPipeline`（编解码器、Handler 链等核心组件）；<br>`GatewayServer` 封装服务启动逻辑，实现服务器“一键启动” |
### 3.2 核心流程示例（“1v1对战”）
1. 玩家A进行登录，登录成功后加入等待匹配队列，当等待匹配队列人数大于两人时，玩家A,玩家B自动加入系统创建的房间，进行对战；
2. 服务器校验玩家状态，同步双方初始手牌、角色信息；
3. 回合开始：向双方发送固定数量骰子，并可以选择进行重掷，重掷完毕后，服务器判定先手玩家，推送“回合开始”消息给双方，玩家在当前回合可以使用行动卡；
4. 技能释放：玩家选择技能，服务器通过`SkillStrategy`执行效果，触发元素反应（`ElementReactionRule`）；
5. 回合结算：创建的附加卡执行效果，服务器同步双方血量、元素状态，判定是否结束对战；
6. 对战结束：服务器记录对战结果，销毁房间。
## 4. 环境搭建与运行步骤
### 4.1 依赖环境
- JDK 17+；
- MySQL 8.0（需提前创建数据库，如game_db）；
- Maven 3.9+（依赖管理）；
### 4.2 本地部署步骤
1. **克隆代码**：
   git clone https://github.com/你的GitHub用户名/你的项目名.git
   cd 你的项目名
